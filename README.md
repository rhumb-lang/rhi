# rhi: The Rhumb Interpreter

**Version:** v0.1.0 (Alpha)

![Vibe Coded](https://img.shields.io/badge/Code_Style-Vibe_Coded-ff69b4?style=flat-square&logo=openai)

> This programming language is a passion project built in my free time. To maintain momentum and focus on high-level design, this project is primarily **vibe coded**.
>
> **What this means:** I utilize AI tools heavily for implementation speed.
>
> **What this does NOT mean:** I am not blindly committing output. I provide the architectural roadmap, deeply scrutinize the generated code, and manually intervene constantly. This workflow allows me to build a complex language faster without sacrificing my vision or technical standards.

`rhi` is the reference interpreter for Rhumb, an image-based, prototype-oriented programming language designed to be English-language free.

This repository contains the core runtime (rhi), comprising the lexer, bytecode compiler, and virtual machine.

## ðŸ“¦ Installation

```bash
# Clone the repository
git clone https://github.com/Hisyeo/rhi.git
cd rhi

# Build the binary
go build -o bin/rhi ./cmd/rhi
```

## ðŸš€ Usage

You can run `rhi` in interactive mode (REPL) or execute scripts directly.

### Interactive Mode (REPL)

Running the binary without arguments starts the Read-Eval-Print Loop.

```console
$ ./bin/rhi
> x := 10
=> 10
> x ** 2
=> 20
```

### Running Scripts

Pass a file path to execute a Rhumb script.

```bash
./bin/rhi ./test/chat.rh
```

### Command Line Flags

The CLI includes tracing tools for debugging the compiler and VM.

| Flag              | Description                                                                                                                         |
|:------------------|:------------------------------------------------------------------------------------------------------------------------------------|
| `-test`           | **Test Mode.** Runs the script and validates assertions defined by the `%=` operator. Output is suppressed unless a failure occurs. |
| `-trace-bytecode` | **Compiler Trace.** Prints the disassembled bytecode chunks generated by the compiler before execution.                             |
| `-trace-stack`    | **Stack Trace.** Logs the state of the data stack after every instruction.                                                          |
| `-trace-space`    | **Realm Trace.** Logs actor-model events: Realm creation, Signal posting, Listener matching, and Bubbling.                          |

**Example: Debugging a script**

```console
$ ./bin/rhi -trace-stack -trace-space ./tests/sieve.rh
```

## âœ… Development Status: v0.1.0 (Realm Realization)

The core language semantics are stable. The focus is now shifting from internal VM mechanics to the Standard Library and tooling.

### Core Features (Implemented)

  - [x] **Syntax & Grammar**: Full ANTLR4 grammar for Maps, Selectors, and Operators.
  - [x] **Prototype Model**: Map objects (`[...]`), Fields, inheritance (`@`), and mutable/immutable assignment.
  - [x] **Bytecode Compiler**: Single-pass incremental compiler with lexical scoping and variable hoisting.
  - [x] **Cactus Stack VM**: Heap-allocated call frames supporting closures (`<fn>`) and "Zombie" frame persistence.
  - [x] **Concurrency (The Tuplespace)**:
      - [x] Signals (`#`) bubbling up the realm hierarchy.
      - [x] Replies (`^`) drilling down into Zombie frames.
      - [x] Realm creation (`<$>`, `<|>`) and Lifecycle.
      - [x] Selectors (`{}`) as pattern-matching listeners.
  - [x] **Control Flow**:
      - [x] Native operators (`=>`, `~>`, `|>`) compiling to jump instructions.
      - [x] Pattern Matching (`..`, `::`).
  - [x] **Testing Infrastructure**: Built-in assertion runner via the `-test` flag.

### Todo List (Roadmap to v0.2)

#### ðŸš§ In Progress

  - [ ] **Standard Library**: Implementation of the `math`, `io`, and `sys` libraries described in architecture docs. (Currently only basic intrinsics like `++`, `**` are native).
  - [ ] **Optimizations**:
      - [ ] Dictionary Mode for large Maps (Switching from linear scan to Hash Map).
      - [ ] "Fast Path" for Signal propagation.

#### ðŸ”® Planned / Concept

  - [ ] **The Freezer**: Serialization engine for persisting the Heap/Space to disk (`.ri` files).
  - [ ] **RHIDE**: Wayland-native graphical IDE ("Code Projector").
  - [ ] **Network Transparency**: Binding Realms to TCP/WebSocket sockets.
  - [ ] **Babel Daemon**: Background text\<-\>binary synchronization for localization.

## ðŸ§ª Testing

The interpreter includes a suite of tests. Tests are written in Rhumb itself using the `%=` assertion operator.

```rhumb
% Example Test
fib(10) %= 55
```

To run a test, use the `-test` flag:

```console
$ time ./bin/rhi -test ./tests/fib.rh
PASS: 9227465

real    0m11.726s
user    0m15.223s
sys     0m0.618s
```